<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/defaultLayout}">
<div layout:fragment="Content">
	<div class="container mt-5">
		<h2 class="mb-4">서버 목록</h2>
		<button type="button" class="btn btn-primary mb-3" onclick="location.href='/server/create'">등록</button>
		<!-- 검색창 및 필터 -->
		<div th:insert="~{common/fragments/search}"></div>
		<div class="table-responsive">
			<table class="table table-bordered table-hover">
				<thead class="table-light">
				<tr>
					<th scope="col">No</th>
					<th scope="col">IP 주소</th>
					<th scope="col">사용자 계정</th>
					<th scope="col">등록일자</th>
					<th scope="col">최근수정일자</th>
					<th scope="col">수정 / 삭제</th>
				</tr>
				</thead>
				<tbody>
				<tr th:each="server, stat : ${servers}" th:attr="data-idx=${server.idx}">
					<td th:text="${totalElements - (startIndex + stat.index) + 1}"></td>
					<td th:text="${server.ip} + ':' + ${server.port}"></td>
					<td th:text="${server.serverUser ?: 'root'}"></td>
					<td th:text="${server.createdDate}"></td>
					<td th:text="${server.updatedDate}"></td>
					<td>
						<button class="btn btn-light btn-sm" th:onclick="'updateServer(' + ${server.idx} + ')'">수정</button>
						<button class="btn btn-outline-danger btn-sm" th:onclick="'deleteServer(' + ${server.idx} + ')'">삭제</button>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
		<!-- 페이징 네비게이션 -->
		<div th:insert="~{common/fragments/pagination}"></div>
	</div>
</div>
<th:block layout:fragment="script">
	<script>
		function updateServer(idx) {
			window.location.href = `/server/update/${idx}`;
		}

		function deleteServer (idx) {
			// console.log(idx)
            const confirmed = confirm('Are you sure delete it?');
            if (!confirmed) {
                return;
            }

            fetch(`/api/server/delete/${idx}`, {
                method: 'DELETE'
            })
              .then(response => {
                  if (response.ok) {
                      alert(`Server Info Deleted Complete.`);
                      const row = document.querySelector(`tr[data-idx='${idx}']`);
                      if (row) {
                          row.remove();
                      }
                  } else {
                      alert(`Failed to Delete Server Info.`);
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
              });
        }
	</script>
</th:block>
</html>