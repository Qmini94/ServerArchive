<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/defaultLayout}">
<div id="layoutAuthentication">
	<div id="layoutAuthentication_content" layout:fragment="Content">
		<main>
			<div class="container">
				<div class="row justify-content-center">
					<div class="col-lg-5">
						<div class="card shadow-lg border-0 rounded-lg mt-5">
							<div class="card-header"><h3 class="text-center font-weight-light my-4">Login</h3>
							</div>
							<div class="card-body">
								<form>
									<div class="form-floating mb-3 md-0">
										<input class="form-control" id="inputUserId" type="text"
											   placeholder="Enter your Id" name="userId"/>
										<label for="inputUserId">아이디</label>
									</div>
									<div class="form-floating mb-3">
										<input class="form-control" id="inputPassword" type="password"
											   placeholder="Password"/>
										<label for="inputPassword">Password</label>
									</div>
									<div class="form-floating mb-3 md-0">
										<input class="form-control" id="inputOtp" type="text"
											   placeholder="Enter issued OTP number" name="otp"/>
										<label for="inputOtp">OTP</label>
										<div>
											<button>OTP 발급 받기</button>
										</div>
									</div>
									<div class="form-check mb-3">
										<input class="form-check-input" id="inputRememberPassword" type="checkbox"
											   value=""/>
										<label class="form-check-label" for="inputRememberPassword">Remember
											Password</label>
									</div>
									<div class="mt-4 mb-0">
										<div class="d-grid">
											<button class="btn btn-primary btn-block btn-login" type="button">Login
												Account
											</button>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
	</div>
</div>
<th:block layout:fragment="script">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
			crossorigin="anonymous"></script>
	<script th:src="@{/js/scripts.js}"></script>
	<script th:src="@{/js/user/form.js}"></script>
	<script type="application/javascript">
        $(function () {
            $(".btn-login").on('click', function (e) {
                e.preventDefault();

                const formData = {
                    userId: $("#inputUserId").val(),
                    password: $("#inputPassword").val(),
                    isRememberPassword: $("#inputRememberPassword").is(":checked"),
                    opt: $("#inputOtp").val()
                };

                if (!checkLoginForm(formData)) {
                    return false;
                }

                $.ajax({
                    type: "POST",
                    url: "/api/user/login",
                    data: JSON.stringify(formData),
                    contentType: 'application/json; charset=utf-8',
                    success: (res) => {
                        const {result, data: {userName} = {}} = res;
                        let title = result === 'SUCCESS' ? 'Success!' : 'Error!';
                        let alertMessage = result === 'SUCCESS' ? `${userName}님 반갑습니다.` : '로그인 도중 문제가 발생했습니다.';
                        let alertType = result === 'SUCCESS' ? 'success' : 'error';
                        let redirectUrl = result === 'SUCCESS' ? '/server/list' : '/user/login';

                        showAlert(title, alertMessage, alertType).then(() => {
                            if (redirectUrl) {
                                window.location = redirectUrl;
                            }
                        });
                    },
                    error: (error) => {
                        showAlert('Error!', '로그인 도중 오류가 발생했습니다.', 'error');
                        console.error(error);
                    }
                });
            });
        });
	</script>
</th:block>
</html>