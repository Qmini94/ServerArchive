<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/defaultLayout}">
<div layout:fragment="Content">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .form-container {
            max-width: 600px;
            margin: auto;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .form-group textarea {
            resize: vertical;
        }
        .form-group input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }
        .form-group input[type="submit"]:hover {
            background-color: #45a049;
        }
    </style>
    <div class="form-container" >
        <h1>업체 업데이트</h1>
        <form method="post">
            <input type="hidden" id="idx" name="idx" th:value="${customer.idx}">
            <input type="hidden" id="mode" name="mode" th:value="${mode}">
            <div class="form-group">
                <label for="companyName">업체명</label>
                <input type="text" id="companyName" name="companyName" th:value="${customer.name}" required maxlength="30">
            </div>

            <div class="form-group">
                <label for="serverIdx">서버 고유번호</label>
                <input type="text" id="serverIdx" name="serverIdx" th:value="${customer.serverIdx}" required maxlength="30">
            </div>

            <div class="form-group">
                <label for="serviceIdx">서비스 고유번호</label>
                <input type="text" id="serviceIdx" name="serviceIdx" th:value="${customer.serviceIdx}" required maxlength="30">
            </div>

            <div class="form-group">
                <label for="managers">담당자</label>
                <input type="text" id="managers" name="managers" th:value="${customer.managers}" required maxlength="255">
            </div>

            <div class="form-group">
                <label for="codeType">업체 유형</label>
                <select id="codeType" name="codeType" required>
                    <option value="">선택하세요</option>
                    <option th:value="1" th:text="'관공서'" th:selected="${customer.codeType == 1}"></option>
                    <option th:value="2" th:text="'학교'" th:selected="${customer.codeType == 2}"></option>
                    <option th:value="3" th:text="'일반 기업'" th:selected="${customer.codeType == 3}"></option>
                    <option th:value="4" th:text="'자체'" th:selected="${customer.codeType == 4}"></option>
                </select>
            </div>

            <div class="form-group">
                <label for="memo">추가사항</label>
                <textarea id="memo" name="memo" rows="4" placeholder="추가사항을 입력하세요." th:text="${customer.memo}"></textarea>
            </div>

            <div class="form-group">
                <label for="registrantId">게시물 등록자 아이디</label>
                <input type="text" id="registrantId" name="registrantId" th:value="${customer.regId}" required maxlength="30">
            </div>

            <div class="form-group">
                <input type="submit" id="save" value="확인">
            </div>
        </form>
    </div>
</div>
<th:block layout:fragment="script">
    <script th:src="@{/js/user/form.js}"></script>
    <script>
        $(function () {
            $("#save").on('click', async function (e) {
                e.preventDefault();
                const idx = $("input[name='idx']").val();
                const mode = $("input[name='mode']").val();
                const url = mode === "create" ? "/api/customer/create" : `/api/customer/update/${idx}`;
                const params = {
                    companyName: $("#companyName").val(),
                    serverIdx: $("#serverIdx").val(),
                    serviceIdx: $("#serviceIdx").val(),
                    managers: $("#managers").val(),
                    codeType: $("#codeType").val(),
                    memo: $("#memo").val(),
                    registrantId: $("#registrantId").val()
                };
                console.log(url)
                console.log(params)
                $.ajax({
                    type: mode === "create" ? "POST" : "PUT",
                    url: url,
                    data: JSON.stringify(params),
                    contentType: 'application/json; charset=utf-8',
                    success: function (res) {
                        alert(res.message);
                        window.location = '/customer/list';
                    },
                    error: function (error) {
                        alert(error);
                        console.error(error);
                    }
                });
            })
        })
    </script>
</th:block>
</html>
